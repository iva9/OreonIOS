{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { Router } from '@angular/router';\nimport { AlertController, LoadingController, ModalController } from '@ionic/angular';\nimport { AngularFireDatabase } from '@angular/fire/database';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { UserService } from '../user.service';\nimport { TutorialPage } from '../tutorial/tutorial.page';\nimport { GooglePlus } from '@ionic-native/google-plus/ngx';\nimport { auth } from 'firebase';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/auth\";\nimport * as i2 from \"@ionic-native/google-plus/ngx\";\nimport * as i3 from \"@ionic/angular\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/fire/database\";\nimport * as i6 from \"@angular/fire/firestore\";\nimport * as i7 from \"../user.service\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"@angular/forms\";\n\nfunction CriarPage_ion_list_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-list\");\n    i0.ɵɵelementStart(1, \"ion-item\", 4);\n    i0.ɵɵelementStart(2, \"ion-label\", 5);\n    i0.ɵɵtext(3, \" Nome de Usuario :\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ion-input\", 6);\n    i0.ɵɵlistener(\"ngModelChange\", function CriarPage_ion_list_7_Template_ion_input_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return ctx_r2.username = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"ion-item\", 4);\n    i0.ɵɵelementStart(6, \"ion-label\", 5);\n    i0.ɵɵtext(7, \"Email :\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"ion-input\", 6);\n    i0.ɵɵlistener(\"ngModelChange\", function CriarPage_ion_list_7_Template_ion_input_ngModelChange_8_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.email = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"ion-item\", 4);\n    i0.ɵɵelementStart(10, \"ion-label\", 5);\n    i0.ɵɵtext(11, \"Senha :\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"ion-input\", 7);\n    i0.ɵɵlistener(\"ngModelChange\", function CriarPage_ion_list_7_Template_ion_input_ngModelChange_12_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.password = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"ion-item\", 4);\n    i0.ɵɵelementStart(14, \"ion-label\", 5);\n    i0.ɵɵtext(15, \"Confirme senha :\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"ion-input\", 7);\n    i0.ɵɵlistener(\"ngModelChange\", function CriarPage_ion_list_7_Template_ion_input_ngModelChange_16_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.cpassword = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"ion-button\", 8);\n    i0.ɵɵlistener(\"click\", function CriarPage_ion_list_7_Template_ion_button_click_17_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.register();\n    });\n    i0.ɵɵtext(18, \"Criar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"p\", 9);\n    i0.ɵɵtext(20, \"Criar com Gmail:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"ion-button\", 10);\n    i0.ɵɵlistener(\"click\", function CriarPage_ion_list_7_Template_ion_button_click_21_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return ctx_r8.loginGooglecom();\n    });\n    i0.ɵɵelement(22, \"ion-icon\", 11);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.username);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.email);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.password);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.cpassword);\n  }\n}\n\nfunction CriarPage_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"h2\", 12);\n    i0.ɵɵtext(2, \"Enviamos um link de verifica\\u00E7\\u00E3o pro seu email confirme ap\\u00F3s clickar nele.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ion-item\", 13);\n    i0.ɵɵelementStart(4, \"ion-button\", 14);\n    i0.ɵɵlistener(\"click\", function CriarPage_div_8_Template_ion_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.enviaremaildeverific();\n    });\n    i0.ɵɵtext(5, \"Reenviar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"ion-button\", 14);\n    i0.ɵɵlistener(\"click\", function CriarPage_div_8_Template_ion_button_click_6_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return ctx_r11.javerifiquei();\n    });\n    i0.ɵɵtext(7, \"Confirmar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport let CriarPage = /*#__PURE__*/(() => {\n  class CriarPage {\n    constructor(afAuth, google, alert, route, afdatabase, firestore, user, modal, loadingC) {\n      this.afAuth = afAuth;\n      this.google = google;\n      this.alert = alert;\n      this.route = route;\n      this.afdatabase = afdatabase;\n      this.firestore = firestore;\n      this.user = user;\n      this.modal = modal;\n      this.loadingC = loadingC;\n      this.arraydenomes = new Array();\n      this.username = \"\";\n      this.abrir = false;\n      this.jalogado = false;\n      this.tem = false;\n      this.email = \"\";\n      this.password = \"\";\n      this.cpassword = \"\";\n    }\n\n    ngOnInit() {\n      this.getDataFromFire();\n    }\n\n    getDataFromFire() {\n      this.afdatabase.list('users').valueChanges().subscribe(data => {\n        this.trataDados(data);\n      });\n    }\n\n    trataDados(dados) {\n      this.items = Object.keys(dados).map(i => dados[i]);\n\n      for (const key in this.items) {\n        this.arraydenomes.push(this.items[key].username.username);\n      }\n    }\n\n    register() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.presentLoading();\n        const todosnomes = this.items;\n        const osnomes = this.username.toLowerCase();\n        const {\n          username,\n          email,\n          password,\n          cpassword\n        } = this;\n        var imgUser = \"https://firebasestorage.googleapis.com/v0/b/oreon-4bfc2.appspot.com/o/profile.png?alt=media&token=3ac5e17d-8119-46e5-9a20-e2e8d1080b18\";\n        username.toLowerCase();\n\n        if (!username) {\n          this.loadingC.dismiss();\n          return this.showalert(\"Erro\", \"insira nome de usuario\");\n        }\n\n        if (this.arraydenomes.includes(osnomes)) {\n          this.loadingC.dismiss();\n          return this.showalert(\"Erro\", \"nome ja existente\");\n        }\n\n        if (password !== cpassword) {\n          this.loadingC.dismiss();\n          return this.showalert(\"Erro\", \"senhas diferentes\");\n        }\n\n        try {\n          const res = yield this.afAuth.createUserWithEmailAndPassword(email, password);\n          console.log(res);\n          var iduser = res.user.uid;\n          this.firestore.collection(\"users\").doc(`${res.user.uid}`).set({\n            username,\n            iduser,\n            imgUser\n          });\n          this.afdatabase.database.ref(`users/${res.user.uid}/username`).set({\n            username,\n            iduser,\n            imgUser\n          });\n          this.enviaremaildeverific();\n          this.user.updateProfile(imgUser, username);\n        } catch (error) {\n          if (error.code == \"auth/weak-password\") {\n            this.loadingC.dismiss();\n            return this.showalert(\"Senha Fraca\", \"Senha deve ter no mínimo 6 caracteres\");\n          }\n\n          if (error.code == \"auth/invalid-email\") {\n            this.loadingC.dismiss();\n            return this.showalert(\"Erro\", \"Email invalido\");\n          }\n\n          if (error.code == \"auth/email-already-in-use\") {\n            this.loadingC.dismiss();\n            return this.showalert(\"Erro\", \"Email ja em uso\");\n          }\n        }\n\n        this.loadingC.dismiss();\n      });\n    }\n\n    showalert(header, message) {\n      return __awaiter(this, void 0, void 0, function* () {\n        const alert = yield this.alert.create({\n          header,\n          message,\n          buttons: [\"Ok\"]\n        });\n        yield alert.present();\n      });\n    }\n\n    abriu() {\n      this.abrir = !this.abrir;\n    }\n\n    loginGooglecom() {\n      this.presentLoading();\n      this.LoginGoogle().then(() => {\n        //const res =  this.Afauth.currentUser\n        this.mostraale();\n      }).catch(err => {\n        this.showalert(\"erro\", err);\n      });\n    }\n\n    LoginGoogle() {\n      return this.google.login({}).then(result => {\n        const user_data_google = result;\n        return this.afAuth.signInWithCredential(auth.GoogleAuthProvider.credential(null, user_data_google.accessToken));\n      });\n    }\n\n    voltar() {\n      this.route.navigate(['./criar-user']);\n    }\n\n    jalogs() {\n      this.jalogado = true;\n    }\n\n    showmodalTutoria() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const modal = yield this.modal.create({\n          component: TutorialPage,\n          componentProps: {}\n        });\n        modal.present();\n      });\n    }\n\n    presentLoading() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.loading = yield this.loadingC.create({\n          cssClass: 'my-custom-class',\n          message: 'Espere um momento...',\n          duration: 2000\n        });\n        yield this.loading.present();\n      });\n    }\n\n    javerifiquei() {\n      return __awaiter(this, void 0, void 0, function* () {\n        this.presentLoading();\n        const foi = yield this.afAuth.currentUser;\n        foi.reload();\n        setTimeout(() => {\n          console.log(\"RELOAD\");\n          var dd = foi.emailVerified;\n          console.log(dd, \"email verified na criar user\");\n\n          if (dd == true) {\n            this.showmodalTutoria();\n            this.route.navigate(['./home']);\n            this.showalert(\"Sucesso!\", \"Bem vindo\");\n          }\n\n          if (dd == false) {\n            this.showalert(\"Ops!\", \"Tente novamente em instantes\");\n          }\n        }, 3500);\n      });\n    }\n\n    enviaremaildeverific() {\n      return __awaiter(this, void 0, void 0, function* () {\n        (yield this.afAuth.currentUser).sendEmailVerification();\n        this.jalogs();\n      });\n    }\n\n    mostraale() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const res = yield this.afAuth.currentUser;\n        this.firestore.collection('users', ref => ref.where('iduser', '==', `${res.uid}`)).snapshotChanges().subscribe(usergg => {\n          if (usergg.length > 0) {\n            this.loadingC.dismiss();\n            this.route.navigate(['/home']);\n            this.showalert('', 'Conta criada com sucesso');\n          } else {\n            var username = \"Usuario\";\n            var imgUser = \"https://firebasestorage.googleapis.com/v0/b/oreon-4bfc2.appspot.com/o/profile.png?alt=media&token=3ac5e17d-8119-46e5-9a20-e2e8d1080b18\";\n            var iduser = res.uid; //display name ja existe\n\n            this.firestore.collection(\"users\").doc(`${res.uid}`).set({\n              username,\n              iduser,\n              imgUser\n            });\n            this.afdatabase.database.ref(`users/${res.uid}/username`).set({\n              username,\n              iduser,\n              imgUser\n            });\n            this.showmodalTutorial();\n            this.route.navigate(['/home']);\n            this.loadingC.dismiss();\n          }\n        });\n      });\n    }\n\n    showmodalTutorial() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const modal = yield this.modal.create({\n          component: TutorialPage,\n          componentProps: {}\n        });\n        modal.present();\n      });\n    }\n\n  }\n\n  CriarPage.ɵfac = function CriarPage_Factory(t) {\n    return new (t || CriarPage)(i0.ɵɵdirectiveInject(i1.AngularFireAuth), i0.ɵɵdirectiveInject(i2.GooglePlus), i0.ɵɵdirectiveInject(i3.AlertController), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i5.AngularFireDatabase), i0.ɵɵdirectiveInject(i6.AngularFirestore), i0.ɵɵdirectiveInject(i7.UserService), i0.ɵɵdirectiveInject(i3.ModalController), i0.ɵɵdirectiveInject(i3.LoadingController));\n  };\n\n  CriarPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: CriarPage,\n    selectors: [[\"app-criar\"]],\n    decls: 9,\n    vars: 2,\n    consts: [[1, \"title\"], [\"slot\", \"start\"], [\"defaultHref\", \"criar-user\", \"text\", \"\", 1, \"margin\", 3, \"click\"], [4, \"ngIf\"], [1, \"holder\"], [\"position\", \"floating\"], [\"type\", \"email\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"password\", 3, \"ngModel\", \"ngModelChange\"], [\"shape\", \"round\", \"expand\", \"full\", \"type\", \"submit\", 3, \"click\"], [1, \"pp\"], [1, \"google\", 3, \"click\"], [\"name\", \"logo-google\", \"size\", \"large\"], [1, \"p\"], [\"lines\", \"none\", 1, \"holder2\"], [\"size\", \"default\", \"type\", \"submit\", 3, \"click\"]],\n    template: function CriarPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\");\n        i0.ɵɵelementStart(1, \"ion-toolbar\");\n        i0.ɵɵelementStart(2, \"ion-title\", 0);\n        i0.ɵɵtext(3, \"Registro\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"ion-buttons\", 1);\n        i0.ɵɵelementStart(5, \"ion-back-button\", 2);\n        i0.ɵɵlistener(\"click\", function CriarPage_Template_ion_back_button_click_5_listener() {\n          return ctx.voltar();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"ion-content\");\n        i0.ɵɵtemplate(7, CriarPage_ion_list_7_Template, 23, 4, \"ion-list\", 3);\n        i0.ɵɵtemplate(8, CriarPage_div_8_Template, 8, 0, \"div\", 3);\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngIf\", !ctx.jalogado);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", ctx.jalogado);\n      }\n    },\n    directives: [i3.IonHeader, i3.IonToolbar, i3.IonTitle, i3.IonButtons, i3.IonBackButton, i3.IonBackButtonDelegate, i3.IonContent, i8.NgIf, i3.IonList, i3.IonItem, i3.IonLabel, i3.IonInput, i3.TextValueAccessor, i9.NgControlStatus, i9.NgModel, i3.IonButton, i3.IonIcon],\n    styles: [\"ion-toolbar[_ngcontent-%COMP%]{--padding-top: 56px ;--background: black}ion-content[_ngcontent-%COMP%]{--ion-background-color: #000000;--ion-color:#FFFFFF}ion-title[_ngcontent-%COMP%]{--color: white;size:large}.holder[_ngcontent-%COMP%]{--color: #FFFFFF;--placeholder-color:#FFFFFF;--background:black}.p[_ngcontent-%COMP%]{color:#fff;margin-left:1em;margin-top:.5em;margin-right:1em;padding-bottom:1em}.google[_ngcontent-%COMP%]{color:#fff;padding-left:10%}.pp[_ngcontent-%COMP%]{color:#fff;margin-left:2ex;margin-top:2ex}.title[_ngcontent-%COMP%]{text-align:center;color:#fff;font-size:30px}.holder2[_ngcontent-%COMP%]{color:#fff;margin-top:-1ex;--placeholder-color:#FFFFFF;--placeholder-opacity: -100%;text-align:center}\"]\n  });\n  return CriarPage;\n})();","map":null,"metadata":{},"sourceType":"module"}