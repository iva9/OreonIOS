{"ast":null,"code":"import { __awaiter } from \"tslib\";\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { AlertController } from '@ionic/angular';\nimport { Router } from '@angular/router';\nimport { UserService } from '../user.service';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { GooglePlus } from '@ionic-native/google-plus/ngx';\nimport { AngularFireDatabase } from '@angular/fire/database';\nimport { auth } from \"firebase\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/fire/auth\";\nimport * as i2 from \"@ionic/angular\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"../user.service\";\nimport * as i5 from \"@ionic-native/google-plus/ngx\";\nimport * as i6 from \"@angular/fire/firestore\";\nimport * as i7 from \"@angular/fire/database\";\nimport * as i8 from \"@angular/common\";\nimport * as i9 from \"@angular/forms\";\n\nfunction LoginPage_ion_list_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"ion-list\");\n    i0.ɵɵelementStart(1, \"ion-item\", 13);\n    i0.ɵɵelementStart(2, \"ion-label\", 10);\n    i0.ɵɵtext(3, \"Email :\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ion-input\", 11);\n    i0.ɵɵlistener(\"ngModelChange\", function LoginPage_ion_list_7_Template_ion_input_ngModelChange_4_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return ctx_r2.email = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"ion-item\", 13);\n    i0.ɵɵelementStart(6, \"ion-label\", 10);\n    i0.ɵɵtext(7, \"senha :\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"ion-input\", 14);\n    i0.ɵɵlistener(\"ngModelChange\", function LoginPage_ion_list_7_Template_ion_input_ngModelChange_8_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r4 = i0.ɵɵnextContext();\n      return ctx_r4.password = $event;\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\");\n    i0.ɵɵelementStart(10, \"p\", 8);\n    i0.ɵɵlistener(\"click\", function LoginPage_ion_list_7_Template_p_click_10_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.abriu();\n    });\n    i0.ɵɵtext(11, \"Esqueci minha senha\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"ion-button\", 15);\n    i0.ɵɵlistener(\"click\", function LoginPage_ion_list_7_Template_ion_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return ctx_r6.login();\n    });\n    i0.ɵɵtext(13, \"Log in\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.email);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r0.password);\n  }\n}\n\nfunction LoginPage_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"h2\", 16);\n    i0.ɵɵtext(2, \"Enviamos um e-mail de verifica\\u00E7\\u00E3o pra voc\\u00EA\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ion-item\", 17);\n    i0.ɵɵelementStart(4, \"ion-button\", 18);\n    i0.ɵɵlistener(\"click\", function LoginPage_div_9_Template_ion_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return ctx_r7.enviaremaildeverific();\n    });\n    i0.ɵɵtext(5, \"Re-enviar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"ion-button\", 18);\n    i0.ɵɵlistener(\"click\", function LoginPage_div_9_Template_ion_button_click_6_listener() {\n      i0.ɵɵrestoreView(_r8);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return ctx_r9.emailverificado();\n    });\n    i0.ɵɵtext(7, \"Confirmar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n}\n\nexport let LoginPage = /*#__PURE__*/(() => {\n  class LoginPage {\n    constructor(afauth, alertController, router, user, google, firestore, afdatabase) {\n      this.afauth = afauth;\n      this.alertController = alertController;\n      this.router = router;\n      this.user = user;\n      this.google = google;\n      this.firestore = firestore;\n      this.afdatabase = afdatabase;\n      this.email = \"\";\n      this.password = \"\";\n      this.emailrecu = \"\";\n      this.abrir = false;\n      this.temqverificar = false;\n    }\n\n    ngOnInit() {}\n\n    login() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const {\n          email,\n          password\n        } = this;\n\n        try {\n          const res = yield this.user.login(email, password);\n\n          if (res.user) {\n            this.user.setUser({\n              username: res.user.displayName,\n              uid: res.user.uid,\n              foto: res.user.photoURL\n            });\n            this.showalert('', 'Login com sucesso');\n            this.router.navigate(['./home']);\n            this.email = \"\";\n            this.password = \"\";\n          }\n        } catch (err) {\n          if (err.code == \"auth/invalid-password\") {\n            return this.showalert(\"Erro\", \"Senha errada\");\n          }\n\n          if (err.code == \"auth/user-not-found\") {\n            return this.showalert(\"Erro\", \"Usuario não encontrado.\");\n          } else {\n            return this.showalert(err.code, err.message);\n          }\n        }\n      });\n    }\n\n    abriu() {\n      this.abrir = !this.abrir;\n    }\n\n    voltar() {\n      this.router.navigate(['./criar-user']);\n    }\n\n    enviar() {\n      var auth = this.afauth;\n      auth.sendPasswordResetEmail(this.emailrecu).catch(error => {\n        return this.showalert(\"Erro\", error);\n      });\n      this.showalert(\"Email enviado!\", \"cheque lixo/spam\");\n    }\n\n    showalert(header, message) {\n      return __awaiter(this, void 0, void 0, function* () {\n        const alert = yield this.alertController.create({\n          header,\n          message,\n          buttons: [\"Ok\"]\n        });\n        yield alert.present();\n      });\n    }\n\n    emailverificado() {\n      return __awaiter(this, void 0, void 0, function* () {\n        var foi = (yield this.afauth.currentUser).emailVerified;\n        console.log(foi);\n      });\n    }\n\n    enviaremaildeverific() {\n      return __awaiter(this, void 0, void 0, function* () {\n        (yield this.afauth.currentUser).sendEmailVerification();\n        this.temqverificar = true;\n        this.emailverificado();\n      });\n    }\n\n    loginGooglecom() {\n      this.LoginGoogle().then(() => {\n        //const res =  this.Afauth.currentUser\n        this.mostraale();\n      }).catch(err => {\n        this.showalert(\"erro\", err);\n      });\n    }\n\n    LoginGoogle() {\n      return this.google.login({}).then(result => {\n        const user_data_google = result;\n        return this.afauth.signInWithCredential(auth.GoogleAuthProvider.credential(null, user_data_google.accesToken));\n      });\n    }\n\n    mostraale() {\n      return __awaiter(this, void 0, void 0, function* () {\n        const res = yield this.afauth.currentUser;\n        this.firestore.collection('users', ref => ref.where('iduser', '==', `${res.uid}`)).snapshotChanges().subscribe(usergg => {\n          if (usergg.length > 0) {\n            this.router.navigate(['/home']);\n            this.showalert('', 'Login com sucesso');\n          } else {\n            var username = \"Usuario\";\n            var imgUser = \"https://firebasestorage.googleapis.com/v0/b/oreon-4bfc2.appspot.com/o/profile.png?alt=media&token=3ac5e17d-8119-46e5-9a20-e2e8d1080b18\";\n            var iduser = res.uid; //display name ja existe\n\n            this.firestore.collection(\"users\").doc(`${res.uid}`).set({\n              username,\n              iduser,\n              imgUser\n            });\n            this.afdatabase.database.ref(`users/${res.uid}/username`).set({\n              username,\n              iduser,\n              imgUser\n            });\n            this.router.navigate(['/home']);\n          }\n        });\n      });\n    }\n\n  }\n\n  LoginPage.ɵfac = function LoginPage_Factory(t) {\n    return new (t || LoginPage)(i0.ɵɵdirectiveInject(i1.AngularFireAuth), i0.ɵɵdirectiveInject(i2.AlertController), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.UserService), i0.ɵɵdirectiveInject(i5.GooglePlus), i0.ɵɵdirectiveInject(i6.AngularFirestore), i0.ɵɵdirectiveInject(i7.AngularFireDatabase));\n  };\n\n  LoginPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: LoginPage,\n    selectors: [[\"app-login\"]],\n    decls: 24,\n    vars: 5,\n    consts: [[1, \"title\"], [\"slot\", \"start\"], [\"defaultHref\", \"criar-user\", \"text\", \"\", 1, \"margin\", 3, \"click\"], [3, \"hidden\"], [4, \"ngIf\"], [1, \"p2\"], [1, \"google\", 3, \"click\"], [\"name\", \"logo-google\", \"size\", \"large\"], [1, \"p\", 3, \"click\"], [1, \"holder2\"], [\"position\", \"floating\"], [\"type\", \"email\", 3, \"ngModel\", \"ngModelChange\"], [\"type\", \"submit\", 3, \"click\"], [1, \"holder\"], [\"type\", \"password\", 3, \"ngModel\", \"ngModelChange\"], [\"shape\", \"round\", \"expand\", \"full\", \"type\", \"submit\", 3, \"click\"], [1, \"p\"], [\"lines\", \"none\", 1, \"holder2\"], [\"size\", \"default\", \"type\", \"submit\", 3, \"click\"]],\n    template: function LoginPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\");\n        i0.ɵɵelementStart(1, \"ion-toolbar\");\n        i0.ɵɵelementStart(2, \"ion-title\", 0);\n        i0.ɵɵtext(3, \"Log in\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"ion-buttons\", 1);\n        i0.ɵɵelementStart(5, \"ion-back-button\", 2);\n        i0.ɵɵlistener(\"click\", function LoginPage_Template_ion_back_button_click_5_listener() {\n          return ctx.voltar();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"ion-content\", 3);\n        i0.ɵɵtemplate(7, LoginPage_ion_list_7_Template, 14, 2, \"ion-list\", 4);\n        i0.ɵɵelementStart(8, \"ion-list\");\n        i0.ɵɵtemplate(9, LoginPage_div_9_Template, 8, 0, \"div\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(10, \"p\", 5);\n        i0.ɵɵtext(11, \"Log in com Gmail:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(12, \"ion-button\", 6);\n        i0.ɵɵlistener(\"click\", function LoginPage_Template_ion_button_click_12_listener() {\n          return ctx.loginGooglecom();\n        });\n        i0.ɵɵelement(13, \"ion-icon\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"ion-content\", 3);\n        i0.ɵɵelementStart(15, \"div\");\n        i0.ɵɵelementStart(16, \"p\", 8);\n        i0.ɵɵlistener(\"click\", function LoginPage_Template_p_click_16_listener() {\n          return ctx.abriu();\n        });\n        i0.ɵɵtext(17, \"Voltar\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"ion-item\", 9);\n        i0.ɵɵelementStart(19, \"ion-label\", 10);\n        i0.ɵɵtext(20, \"Email da conta :\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"ion-input\", 11);\n        i0.ɵɵlistener(\"ngModelChange\", function LoginPage_Template_ion_input_ngModelChange_21_listener($event) {\n          return ctx.emailrecu = $event;\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(22, \"ion-button\", 12);\n        i0.ɵɵlistener(\"click\", function LoginPage_Template_ion_button_click_22_listener() {\n          return ctx.enviar();\n        });\n        i0.ɵɵtext(23, \"enviar\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"hidden\", ctx.abrir);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", !ctx.temqverificar);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngIf\", ctx.temqverificar);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"hidden\", !ctx.abrir);\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"ngModel\", ctx.emailrecu);\n      }\n    },\n    directives: [i2.IonHeader, i2.IonToolbar, i2.IonTitle, i2.IonButtons, i2.IonBackButton, i2.IonBackButtonDelegate, i2.IonContent, i8.NgIf, i2.IonList, i2.IonButton, i2.IonIcon, i2.IonItem, i2.IonLabel, i2.IonInput, i2.TextValueAccessor, i9.NgControlStatus, i9.NgModel],\n    styles: [\"ion-toolbar[_ngcontent-%COMP%]{--padding-top: 56px ;--background: black}ion-content[_ngcontent-%COMP%]{--ion-background-color: #000000;--ion-color:#FFFFFF}ion-title[_ngcontent-%COMP%]{--color: white;size:large}.holder[_ngcontent-%COMP%]{--color: #FFFFFF;--placeholder-color:#FFFFFF;--background:black}.holder2[_ngcontent-%COMP%]{color:#fff;margin-top:-1ex;--placeholder-color:#FFFFFF;--placeholder-opacity: -100%}.holder3[_ngcontent-%COMP%]{color:#fff;margin-top:-1.5ex;--placeholder-color:#FFFFFF;--placeholder-opacity: -100%}.title[_ngcontent-%COMP%]{text-align:center;color:#fff;font-size:30px}.p[_ngcontent-%COMP%]{color:#fff;margin-left:1em;margin-top:.5em;margin-right:1em;padding-bottom:1em}.google[_ngcontent-%COMP%]{color:#fff;padding-left:10%}.p2[_ngcontent-%COMP%]{color:#fff;margin-left:2ex;margin-top:2ex}\"]\n  });\n  return LoginPage;\n})();","map":null,"metadata":{},"sourceType":"module"}